<error-modal message="controller.errorMsg" visible="controller.error"></error-modal>

<div class="dialog-modal" ng-if="controller.showMediaBrowser">
	<div class="big-dialog-box">
		<ng-include ng-controller="mediaCtrl as mediaController" src="'states/media/dash-media.html'" ng-init="mediaController.multiSelect= false"></ng-include>
	</div>
</div>

<div class="sub-menu">
    <h>Posts<img ng-show="controller.loading" src="/media/images/loader.gif" /></h>
    <div class="console" ng-show="!controller.showNewPostForm">
        <add-button ng-click="controller.newPostMode()" text="'New Post'"></add-button>
        <toggle-button ng-click="controller.showFilters = !controller.showFilters" text="'Filters'"></toggle-button>
        <search-bar value="controller.searchKeyword" on-click="controller.pager.invalidate"></search-bar>
        <div class="fix"></div>
    </div>

    <div class="console-buttons" ng-show="controller.showNewPostForm">
        <approve-button ng-click="controller.createPost()" ng-class="{'hidden': controller.loading}" text="!controller.editMode ? 'New Post' : 'Update'"></approve-button>
        <remove-button ng-class="{'hidden': controller.loading}" ng-click="controller.showNewPostForm = false" text="'Close'"></remove-button>
        <div class="success">{{controller.successMessage}}</div>
    </div>
</div>

<div class="content-view">
    <div class="filter-options animated-panel" ng-show="controller.showFilters && !controller.showNewPostForm">
        <div class="filter-group">
            <div class="label">Sort Order</div>
            <div class="checkbox">
                <div class="tick-box" ng-click="controller.swapOrder()">
                    <div class="tick" ng-show="controller.sortOrder != 'asc'"></div>
                </div>
                Newest
            </div>
            <div class="checkbox">
                <div class="tick-box" ng-click="controller.swapOrder()">
                    <div class="tick" ng-show="controller.sortOrder == 'asc'"></div>
                </div>
                Oldest
            </div>
        </div>

        <div class="filter-group">
            <div class="label">Sort Order</div>
            <div class="checkbox">
                <div class="tick-box" ng-click="controller.swapSortType()">
                    <div class="tick" ng-show="controller.sortType != 'created'"></div>
                </div>
                Last Modified
            </div>
            <div class="checkbox">
                <div class="tick-box" ng-click="controller.swapSortType()">
                    <div class="tick" ng-show="controller.sortType == 'created'"></div>
                </div>
                Created
            </div>
        </div>

        <div class="filter-group">
            <div class="label">Category</div>
            <div class="dropdown">
                <select ng-model="controller.searchCategory" ng-change="controller.pager.invalidate()">
                    <option value=""></option>
                    <option ng-repeat="category in controller.categories" ng-value="category.slug">{{category.title}}</option>
                </select>
            </div>
        </div>

        <div class="fix"></div>
    </div>

    <div class="content-view-item new-post-form" ng-show="controller.showNewPostForm">

        <form name="newPostForm" ng-submit="newPostForm.$valid && controller.createPost()" novalidate>
            <div class="content-view-detail">
                <div class="label">Title: <span class="info">The title of this new post</span></div>
                <input type="text" name="nTitle" ng-model="controller.postToken.title" ng-minlength="1" required ng-change="controller.updateDefaultSlug(newPostForm)" />
                <div class="error" ng-show="newPostForm.nTitle.$error.required && (newPostForm.$submitted || newPostForm.nTitle.$touched)">Please enter a valid title</div>
                <div class="fix"></div>
            </div>
            <div class="content-view-detail">
                <div class="label">Content: <span class="info">The main content of the post</span></div>
                <div class="fix"></div>
                <textarea class="newPostText" name="nContent"></textarea>
                <div class="fix"></div>
            </div>
            <div class="content-view-detail">
                <div class="label">Slug: <span class="info">The url tag for this post</span></div>
                <input type="text" name="nSlug" ng-model="controller.postToken.slug" ng-minlength="1" required ng-change="controller.checkSlug()" />
                <div class="error" ng-show="newPostForm.nSlug.$error.required && (newPostForm.$submitted || newPostForm.nSlug.$touched)">Please enter a valid slug</div>
                <div class="fix"></div>
            </div>
            <div class="content-view-detail">
                <div class="label">Brief: <span class="info">Optional, a small bit of text to describe the post</span></div>
                <input type="text" name="nBrief" ng-model="controller.postToken.brief" ng-minlength="1" required" />
                <div class="fix"></div>
            </div>
            <div class="content-view-detail">
                <div class="label">
                    <add-button class="feature-img-button img-selector" ng-click="controller.newPostMode()" text="'...'"></add-button>
                    Featured Image: <span class="info">The main image for this post</span>
                </div>

                <input type="text" name="nFeaturedImage" ng-model="controller.postToken.featuredImage" />
                <div class="fix"></div>
            </div>
        </form>

        <div class="categories">
            <form name="newCategoryForm" ng-submit="newCategoryForm.$valid && controller.createCategory()" novalidate>
                <div class="category-header">Categories:</div>
                <div class="post-categories" ng-show="controller.categories.length != 0">
                    <div class="category" ng-repeat="category in controller.categories">
                        <div class="tick-box" ng-show="!controller.showCategoryDelete" ng-click="controller.selectCategory(category)">
                            <div class="tick" ng-show="controller.postToken.categories.indexOf(category.slug) != -1"></div>
                        </div>
                        <div ng-show="controller.showCategoryDelete" class="cross" ng-click="controller.removeCategory(category)"></div>
                        {{category.title}} - {{category.slug}}
                    </div>
                </div>
                <div class="category-buttons">
                    <div class="nav-button"><a ng-click="controller.showCategoryForm = !controller.showCategoryForm">{{ controller.showCategoryForm ? "- New Category" : "+ New Category" }}</a></div>
                    <div class="new-category animated-panel" ng-show="controller.showCategoryForm">
                        <div class="label">Title</div>
                        <input ng-model="controller.categoryToken.title" type="text" name="nTags" ng-minlength="1" />

                        <div class="label">Slug</div>
                        <input ng-model="controller.categoryToken.slug" type="text" name="nTags" ng-minlength="1" />

                        <div ng-show="controller.categories.length != 0">
                            <div class="label">Parent</div>
                            <div class="dropdown">
                                <select name="nType" ng-model="controller.categoryToken.parent">
                                    <option value=""></option>
                                    <option ng-repeat="category in controller.categories" ng-value="category.slug">{{category.title}}</option>
                                </select>
                            </div>
                        </div>

                        <div class="fix"></div>
                        <img ng-show="controller.loading" src="/media/images/loader.gif" />
                        <div ng-class="{'hidden': controller.loading}" ng-click="controller.createCategory()" class="button blue">
                            <div class="cross"></div> Add Category
                        </div>
                    </div>
                    <div class="nav-button red-highlight" ng-show="controller.categories.length != 0"><a ng-click="controller.showCategoryDelete = !controller.showCategoryDelete">{{ controller.showCategoryDelete ? "- Remove Category" : "+ Remove Category" }}</a></div>
                </div>

            </form>
            <div class="fix"></div>
        </div>

        <div class="tags">
            <div class="tag-header">Tags:</div>
            <div class="tag-content">
                <div class="tag" ng-repeat="tag in controller.postToken.tags">
                    <div class="cross" ng-click="controller.removeTag(tag)"></div>{{tag}}
                </div>
                <div class="fix"></div>
                <div class="new-tag">
                    <form name="tagForm">
                        <input ng-model="controller.tagString" type="text" name="nTags" ng-minlength="1" />
                    </form>
                    <add-button ng-click="controller.processTags()" ng-click="controller.newPostMode()" text="'Add Tags'"></add-button>
                </div>
            </div>
        </div>

        <div class="tags">
            <div class="tag-header">Visibility:</div>
            <div class="checkbox">
                <div class="tick-box" ng-click="controller.postToken.public = true">
                    <div class="tick" ng-show="controller.postToken.public"></div>
                </div>
                Public
            </div>
            <div class="checkbox">
                <div class="tick-box" ng-click="controller.postToken.public = false">
                    <div class="tick" ng-show="!controller.postToken.public"></div>
                </div>
                Private
            </div>
        </div>

        <div class="fix"></div>
    </div>

    <div class="content-view-item-list" ng-show="!controller.showNewPostForm">
        <div pager interface="controller.pager" limit="2">
            <item-panel ng-repeat="post in controller.posts" model="post" on-delete="removePost">
                <panel-preview>
                    <div class="view-item-label date">Created: {{post.createdOn | date:"MM/dd/yyyy 'at' h:mma"}}</div>
                    <div class="view-item-label date nav-button red-highlight"><a href="" ng-click="controller.editPostMode(post)">Edit</a></div>
                    <div class="view-item-label"><b>{{post.title}}</b> : <span class="slug">{{post.slug}}</span></div>
                </panel-preview>
                <panel-content>
                    <div class="content-view-detail">
                        <div class="label">ID: </div>
                        <div class="textbox">{{post._id}}</div>
                        <div class="fix"></div>
                    </div>
                    <div class="content-view-detail">
                        <div class="label">Brief: </div>
                        <div class="textbox">{{post.brief}}</div>
                        <div class="fix"></div>
                    </div>
                    <div class="content-view-detail">
                        <div class="label">Created on: </div>
                        <div class="textbox">{{post.createdOn | date:"MM/dd/yyyy 'at' h:mma"}}</div>
                        <div class="fix"></div>
                    </div>
                    <div class="content-view-detail">
                        <div class="label">Last Updated: </div>
                        <div class="textbox">{{post.lastUpdated | date:"MM/dd/yyyy 'at' h:mma"}}</div>
                        <div class="fix"></div>
                    </div>
                    <div class="content-view-detail">
                        <div class="label">Visibility: </div>
                        <div class="textbox">{{post.public ? "public" : "private"}}</div>
                        <div class="fix"></div>
                    </div>
                    <div class="content-view-detail">
                        <div class="label">Tags: </div>
                        <div class="textbox">{{post.tags.join(", ")}}</div>
                        <div class="fix"></div>
                    </div>
                    <div class="content-view-detail">
                        <div class="label">Categories: </div>
                        <div class="textbox">{{post.categories.join(", ")}}</div>
                        <div class="fix"></div>
                    </div>
                    <div class="content-view-detail">
                        <div class="label">Content</div>
                        <div class="preview" ng-bind-html="post.content"></div>
                        <div class="fix"></div>
                    </div>
                    <div class="content-view-detail">
                        <div class="label">Featured Image</div>
                        <div ng-bind-html="post.featuredImage"></div>
                        <div class="fix"></div>
                    </div>

                    <div class="content-view-detail">
                        <div class="buttons">
                            <div class="nav-button red-highlight" ng-hide="$parent.confirmDelete" ng-click="$parent.confirmDelete=true"><a href="">Remove Post</a></div>
                            <add-button ng-click="controller.editPostMode(post)" no-icon="true" text="'Edit Post'"></add-button>
                        </div>
                    </div>
                </panel-content>
            </item-panel>
        </div>
    </div>
</div>